<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cluq - Tài khoản của tôi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS (copy from dashboard.html for consistency) */
        body {
            background-image: radial-gradient(circle at top left, rgba(0, 188, 212, 0.1) 0%, transparent 40%),
                radial-gradient(circle at bottom right, rgba(0, 188, 212, 0.1) 0%, transparent 40%);
            background-size: 100% 100%;
            background-repeat: no-repeat;
            animation: backgroundShift 20s infinite alternate;
        }

        @keyframes backgroundShift {
            0% {
                background-position: 0% 0%, 100% 100%;
            }

            100% {
                background-position: 100% 100%, 0% 0%;
            }
        }

        .backdrop-blur-md {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .animate-fadeIn {
            animation: fadeIn 1s ease-out forwards;
            opacity: 0;
            will-change: transform, opacity;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .shine-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.4s ease-out;
            will-change: transform;
        }

        .shine-effect:hover::before {
            left: 100%;
        }

        /* Responsive Optimization for Mobile Performance */
        @media (max-width: 767px) {
            body {
                animation: none;
                /* Disable backgroundShift on mobile */
                background-image: none;
                /* Remove radial gradients for body */
            }

            /* Adjust font sizes and padding for better mobile readability and less clutter */
            h1 {
                font-size: 3.5rem !important;
                /* Smaller on mobile */
            }

            p {
                font-size: 1.1rem !important;
                /* Smaller on mobile */
            }

            h2 {
                font-size: 2.5rem !important;
                /* Smaller on mobile */
            }

            input,
            button {
                font-size: 1rem !important;
                /* Smaller input/button text */
                padding: 12px 20px !important;
                /* Smaller padding */
            }

            .text-lg {
                /* For messageArea */
                font-size: 1rem !important;
            }

            .text-xl {
                /* For button text */
                font-size: 1.1rem !important;
            }

            .text-sm {
                /* For nav links */
                font-size: 0.85rem !important;
            }

            .text-base {
                /* For nav links */
                font-size: 0.9rem !important;
            }

            .text-4xl {
                /* For logo */
                font-size: 2.5rem !important;
            }

            .text-5xl {
                /* For logo */
                font-size: 3rem !important;
            }

            /* Make table responsive on small screens */
            .table-container {
                overflow-x: auto;
                /* Allows horizontal scrolling for table */
                -webkit-overflow-scrolling: touch;
                /* Smooth scrolling on iOS */
            }

            table {
                min-width: 600px;
                /* Ensure table content is not too cramped */
            }

            .shortlink-button {
                padding: 6px 10px !important;
                /* Smaller padding for mobile buttons */
                font-size: 0.8rem !important;
                /* Smaller font for mobile buttons */
            }

            #sidebar {
                width: 80%;
                /* Take up 80% width on small screens */
                max-width: 320px;
                /* Max width for mobile sidebar */
            }
        }
    </style>
</head>

<body
    class="font-inter antialiased bg-[#0D1117] text-[#C9D1D9] leading-relaxed overflow-x-hidden min-h-screen flex flex-col">
    <header
        class="bg-[#161B22] bg-opacity-80 backdrop-blur-md py-3 shadow-2xl flex justify-between items-center sticky top-0 z-50 border-b border-teal-600/20">
        <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center w-full">
            <a href="http://127.0.0.1:5500/FE/index.html" class="text-4xl sm:text-5xl font-extrabold text-teal-400 no-underline inline-block transition-all duration-300 ease-in-out ml-2 sm:ml-4
                      hover:text-teal-300 drop-shadow-lg hover:drop-shadow-xl z-[1001]">
                Cluq
            </a>
            <nav class="mr-2 sm:mr-4 flex items-center">
                <button id="sidebarToggleBtn"
                    class="text-gray-100 ml-4 p-2 rounded-md hover:bg-teal-700/30 transition-colors duration-200 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <button id="logoutButton" class="text-sm sm:text-base text-gray-100 no-underline font-semibold ml-4 sm:ml-6 px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg sm:rounded-xl transition-all duration-300 ease-in-out relative overflow-hidden shine-effect
                          hover:bg-red-700 hover:text-white hover:translate-y-[-2px] z-[1001]">
                    Đăng xuất
                </button>
            </nav>
        </div>
    </header>

    <main class="flex-grow py-10 px-4 animate-fadeIn">
        <div class="container mx-auto max-w-6xl">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-8 text-teal-400 drop-shadow-md">Tài khoản của
                tôi</h1>
            <p class="text-lg text-gray-300 text-center mb-10">Xem và quản lý thông tin tài khoản của bạn.</p>

            <div id="loadingIndicator" class="text-center text-teal-400 text-xl font-semibold my-10">Đang tải thông tin
                tài khoản...</div>
            <div id="errorMessage" class="text-center text-red-500 text-lg font-semibold my-10 hidden"></div>
            <div id="successMessage" class="text-center text-green-500 text-lg font-semibold my-10 hidden"></div>

            <div id="accountInfoContainer"
                class="bg-[#161B22] p-8 rounded-xl shadow-2xl border border-teal-600/30 hidden">
                <div id="displayMode">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-200 text-lg mb-6">
                        <div>
                            <p class="font-semibold text-gray-400">Tài khoản:</p>
                            <p id="accountDisplay" class="truncate"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400"">Số dư:</p>
                            <p id=" balanceDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Vai trò:</p>
                            <p id="roleDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Ngày tạo:</p>
                            <p id="createAtDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Cập nhật lần cuối:</p>
                            <p id="updateAtDisplay"></p>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-200 text-lg mb-6">
                        <div>
                            <p class="font-semibold text-gray-400">Tên:</p>
                            <p id="nameDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Email:</p>
                            <p id="emailDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Tên ngân hàng:</p>
                            <p id="bankNameDisplay"></p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-400">Địa chỉ ngân hàng:</p>
                            <p id="bankAddressDisplay"></p>
                        </div>
                    </div>
                    <button id="editProfileBtn"
                        class="bg-teal-500 text-gray-900 px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-teal-500/40 relative overflow-hidden shine-effect
                                   hover:bg-teal-400 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-teal-500/60">
                        Cập nhật hồ sơ
                    </button>
                    <button id="changePasswordBtn"
                        class="mt-4 bg-blue-500 text-white px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-blue-500/40 relative overflow-hidden shine-effect
                                   hover:bg-blue-400 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-blue-500/60">
                        Đổi mật khẩu
                    </button>
                </div>

                <form id="profileUpdateForm" class="hidden">
                    <h2 class="text-3xl font-bold text-teal-300 mb-6">Cập nhật hồ sơ của bạn</h2>
                    <div class="flex flex-col gap-4 mb-6">
                        <div>
                            <label for="nameInput" class="block text-gray-300 text-base font-semibold mb-2">Tên</label>
                            <input type="text" id="nameInput" placeholder="Nhập tên của bạn"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                        <div>
                            <label for="emailInput"
                                class="block text-gray-300 text-base font-semibold mb-2">Email</label>
                            <input type="email" id="emailInput" placeholder="Nhập email của bạn"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                        <div>
                            <label for="bankNameInput" class="block text-gray-300 text-base font-semibold mb-2">Tên ngân
                                hàng</label>
                            <input type="text" id="bankNameInput" placeholder="Nhập tên ngân hàng"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                        <div>
                            <label for="bankAddressInput" class="block text-gray-300 text-base font-semibold mb-2">Địa
                                chỉ ngân hàng</label>
                            <input type="text" id="bankAddressInput" placeholder="Nhập địa chỉ ngân hàng"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button type="submit"
                            class="bg-teal-500 text-gray-900 px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-teal-500/40 relative overflow-hidden shine-effect
                                       hover:bg-teal-400 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-teal-500/60">
                            Lưu thay đổi
                        </button>
                        <button type="button" id="cancelEditBtn"
                            class="bg-gray-600 text-white px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-gray-600/40 relative overflow-hidden shine-effect
                                       hover:bg-gray-500 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-gray-500/60">
                            Hủy
                        </button>
                    </div>
                </form>

                <form id="changePasswordForm" class="hidden">
                    <h2 class="text-3xl font-bold text-teal-300 mb-6">Đổi mật khẩu</h2>
                    <div class="flex flex-col gap-4 mb-6">
                        <div>
                            <label for="currentPasswordInput"
                                class="block text-gray-300 text-base font-semibold mb-2">Mật khẩu hiện tại</label>
                            <input type="password" id="currentPasswordInput" placeholder="Nhập mật khẩu hiện tại"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                        <div>
                            <label for="newPasswordInput" class="block text-gray-300 text-base font-semibold mb-2">Mật
                                khẩu mới</label>
                            <input type="password" id="newPasswordInput" placeholder="Nhập mật khẩu mới"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                        <div>
                            <label for="confirmPasswordInput"
                                class="block text-gray-300 text-base font-semibold mb-2">Xác nhận mật khẩu mới</label>
                            <input type="password" id="confirmPasswordInput" placeholder="Xác nhận mật khẩu mới"
                                class="w-full p-3 border-2 border-teal-500 rounded-lg bg-[#0D1117] text-gray-100 text-base transition-all duration-300 ease-in-out shadow-inner shadow-gray-900/50
                                          placeholder:text-gray-500 focus:outline-none focus:border-teal-400 focus:shadow-lg focus:shadow-teal-500/40 focus:bg-[#1A212B]">
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button type="submit"
                            class="bg-blue-500 text-white px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-blue-500/40 relative overflow-hidden shine-effect
                                       hover:bg-blue-400 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-blue-500/60">
                            Lưu mật khẩu mới
                        </button>
                        <button type="button" id="cancelChangePasswordBtn"
                            class="bg-gray-600 text-white px-6 py-3 text-lg font-bold rounded-lg cursor-pointer transition-all duration-300 ease-in-out w-full shadow-lg shadow-gray-600/40 relative overflow-hidden shine-effect
                                       hover:bg-gray-500 hover:translate-y-[-2px] hover:shadow-xl hover:hover:shadow-gray-500/60">
                            Hủy
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </main>

    <div id="sidebar"
        class="fixed top-0 right-0 h-full w-64 bg-[#161B22] shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-[1002]">
        <div class="p-6">
            <h3 class="text-xl font-bold text-teal-400 mb-6 border-b border-teal-700/50 pb-3">Menu</h3>
            <nav>
                <ul>
                    <li class="mb-4">
                        <a href="http://127.0.0.1:5500/FE/dashboard.html"
                            class="flex items-center text-gray-200 hover:text-teal-400 text-lg font-semibold transition-colors duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7m7-7v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                                </path>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="http://127.0.0.1:5500/FE/manage-links.html"
                            class="flex items-center text-gray-200 hover:text-teal-400 text-lg font-semibold transition-colors duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2">
                                </path>
                            </svg>
                            Quản lý liên kết
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="http://127.0.0.1:5500/FE/my-account.html"
                            class="flex items-center text-gray-200 hover:text-teal-400 text-lg font-semibold transition-colors duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Tài khoản của tôi
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#"
                            class="flex items-center text-gray-200 hover:text-teal-400 text-lg font-semibold transition-colors duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.568.356 1.153-.133 1.065-2.572z">
                                </path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Cài đặt
                        </a>
                    </li>
                    <div id="adminMenuSection" class="hidden">
                        <li class="mb-4 border-t border-teal-700/50 pt-4 mt-4">
                            <h4 class="text-gray-400 text-sm font-semibold uppercase mb-2">Admin</h4>
                            <a href="http://127.0.0.1:5500/FE/manager-users.html"
                                class="flex items-center text-gray-200 hover:text-teal-400 text-lg font-semibold transition-colors duration-200">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 20h2a2 2 0 002-2V7.5L14.5 4H9a2 2 0 00-2 2v12a2 2 0 002 2h5M7 12h5m-5 4h5M9 4h6v6h-6V4z">
                                    </path>
                                </svg>
                                Quản lý người dùng
                            </a>
                        </li>
                    </div>
                </ul>
            </nav>
        </div>
    </div>
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-[1001] hidden"></div>

    <footer
        class="bg-[#161B22] py-8 sm:py-10 text-center text-gray-400 text-sm sm:text-base border-t border-teal-600/10 shadow-inner shadow-gray-900/50">
        <div class="container mx-auto px-4 sm:px-5">
            <p>&copy; <span id="year"></span> Cluq. Mọi quyền được bảo lưu.</p>
            <script>
                document.getElementById("year").textContent = new Date().getFullYear();
            </script>
            <br>
            <p>Develope by <a href="https://github.com/shyhubb">Shyhub</a> </p>
        </div>
    </footer>

    <script>
        // Constants used across multiple files
        const BASE_SHORT_URL_DOMAIN = 'http://localhost:8080';
        const USER_API_V1_PATH = '/v1/user';
        const PRIVATE_SHORT_LINK_API_V1_PATH = '/v1/user/link';
        const WEB_CONSTANTS_BASE_SUCCESS = 'Thành công.';
        const WEB_CONSTANTS_DONT_HAVE_SHORTLINK_IN_SYSTEM = 'Bạn chưa tạo shortlink nào.';
        const WEB_CONSTANTS_SHORT_CODE_LENGTH_ERROR = 'Mã rút gọn phải có ít nhất 6 ký tự.';
        const WEB_CONSTANTS_SHORT_CODE_INVALID_CHARACTERS_ERROR = 'Mã custom shortlink không hợp lệ, chỉ chấp nhận chữ cái và số.';
        const WEB_CONSTANTS_SHORT_CODE_EXISTS_ERROR = 'Mã rút gọn đã tồn tại.';
        const WEB_CONSTANTS_CREATE_LINK_LIMIT = 'Bạn đã đạt giới hạn tạo Shortlink.';
        const WEB_CONSTANTS_DELETE_ACCOUNT_FAILED_SELF = 'Không thể xóa tài khoản của chính bạn.';


        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                // If no token, redirect to login page
                window.location.href = 'http://127.0.0.1:5500/FE/index.html';
                return;
            }

            // Elements for displaying profile info
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const accountInfoContainer = document.getElementById('accountInfoContainer');
            const accountDisplay = document.getElementById('accountDisplay');
            const balanceDisplay = document.getElementById('balanceDisplay'); // <-- Đây là phần tử hiển thị số dư
            const roleDisplay = document.getElementById('roleDisplay');
            const createAtDisplay = document.getElementById('createAtDisplay');
            const updateAtDisplay = document.getElementById('updateAtDisplay');

            // Display Mode elements
            const displayMode = document.getElementById('displayMode');
            const nameDisplay = document.getElementById('nameDisplay');
            const emailDisplay = document.getElementById('emailDisplay');
            const bankNameDisplay = document.getElementById('bankNameDisplay');
            const bankAddressDisplay = document.getElementById('bankAddressDisplay');

            const editProfileBtn = document.getElementById('editProfileBtn');
            const changePasswordBtn = document.getElementById('changePasswordBtn');

            // Log để kiểm tra xem các phần tử có được tìm thấy không
            console.log('Phần tử balanceDisplay:', balanceDisplay);
            console.log('Phần tử bankNameDisplay:', bankNameDisplay);
            console.log('Phần tử bankAddressDisplay:', bankAddressDisplay);


            // Edit Mode elements
            const profileUpdateForm = document.getElementById('profileUpdateForm');
            const nameInput = document.getElementById('nameInput');
            const emailInput = document.getElementById('emailInput');
            const bankNameInput = document.getElementById('bankNameInput');
            const bankAddressInput = document.getElementById('bankAddressInput');
            const cancelEditBtn = document.getElementById('cancelEditBtn');

            // Change Password elements
            const changePasswordForm = document.getElementById('changePasswordForm');
            const currentPasswordInput = document.getElementById('currentPasswordInput');
            const newPasswordInput = document.getElementById('newPasswordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const cancelChangePasswordBtn = document.getElementById('cancelChangePasswordBtn');


            const logoutButton = document.getElementById('logoutButton');

            // Sidebar Elements
            const sidebar = document.getElementById('sidebar');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const adminMenuSection = document.getElementById('adminMenuSection');

            // Store current profile data to revert on cancel
            let currentProfileData = {};

            // Event Listeners for Sidebar
            sidebarToggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('translate-x-full');
                sidebarOverlay.classList.toggle('hidden');
            });

            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.add('translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            // Logout button functionality
            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('jwtToken');
                window.location.href = 'http://127.0.0.1:5500/FE/index.html';
            });

            // Helper function to format date/time
            function formatDateTime(dateTimeString) {
                if (!dateTimeString) return 'N/A';
                try {
                    return new Date(dateTimeString).toLocaleString('vi-VN');
                } catch (e) {
                    console.error("Error parsing date:", dateTimeString, e);
                    return dateTimeString;
                }
            }

            // Function to fetch and display user profile
            async function fetchUserProfile() {
                loadingIndicator.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                successMessage.classList.add('hidden');
                accountInfoContainer.classList.add('hidden');

                try {
                    const apiUrl = BASE_SHORT_URL_DOMAIN + USER_API_V1_PATH + '/getprofile';
                    const response = await fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                    });

                    const data = await response.json();
                    console.log('User Profile API Response:', data);

                    if (response.ok && data.message === WEB_CONSTANTS_BASE_SUCCESS) {
                        if (data.data) {
                            console.log('API call successful, attempting to display data.');
                            currentProfileData = data.data;

                            // Debugging: Kiểm tra giá trị balance nhận được từ API
                            console.log('Giá trị balance từ API:', currentProfileData.balance);

                            // Populate display elements with null checks
                            if (accountDisplay) accountDisplay.textContent = currentProfileData.account || 'N/A';
                            // Dòng này hiển thị số dư, kiểm tra nếu nó không hiển thị, hãy kiểm tra console log ở trên
                            if (balanceDisplay) balanceDisplay.textContent = `${currentProfileData.balance !== undefined && currentProfileData.balance !== null ? currentProfileData.balance.toLocaleString('vi-VN') : 'N/A'} VND`;
                            if (roleDisplay) roleDisplay.textContent = currentProfileData.role || 'N/A';
                            if (createAtDisplay) createAtDisplay.textContent = formatDateTime(currentProfileData.createAt);
                            if (updateAtDisplay) updateAtDisplay.textContent = formatDateTime(currentProfileData.updateAt);

                            if (nameDisplay) nameDisplay.textContent = currentProfileData.name || 'Chưa cập nhật';
                            if (emailDisplay) emailDisplay.textContent = currentProfileData.email || 'Chưa cập nhật';
                            if (bankNameDisplay) bankNameDisplay.textContent = currentProfileData.bankName || 'Chưa cập nhật';
                            // Đã sửa lỗi chính tả: 'bankAdress' từ JSON thành 'bankAddressDisplay' để hiển thị
                            if (bankAddressDisplay) bankAddressDisplay.textContent = currentProfileData.bankAdress || 'Chưa cập nhật';

                            // Populate form fields (they are hidden by default)
                            if (nameInput) nameInput.value = currentProfileData.name || '';
                            if (emailInput) emailInput.value = currentProfileData.email || '';
                            if (bankNameInput) bankNameInput.value = currentProfileData.bankName || '';
                            // Đã sửa lỗi chính tả: 'bankAdress' từ JSON thành 'bankAddressInput' để cập nhật
                            if (bankAddressInput) bankAddressInput.value = currentProfileData.bankAdress || '';

                            // Conditional display for admin menu
                            if (currentProfileData.role === 'ADMIN') {
                                if (adminMenuSection) adminMenuSection.classList.remove('hidden');
                            } else {
                                if (adminMenuSection) adminMenuSection.classList.add('hidden');
                            }

                            if (accountInfoContainer) accountInfoContainer.classList.remove('hidden');
                            showDisplayMode(); // Ensure display mode is shown initially
                        } else {
                            errorMessage.textContent = 'Phản hồi API không hợp lệ: Thiếu dữ liệu người dùng.';
                            errorMessage.classList.remove('hidden');
                        }
                    } else {
                        let msg = data.message || 'Không thể tải thông tin tài khoản. Vui lòng thử lại.';
                        if (data.message === WEB_CONSTANTS_DELETE_ACCOUNT_FAILED_SELF) {
                            msg = 'Không thể xóa tài khoản của chính bạn. Vui lòng thử lại với một tài khoản khác.';
                        }
                        if (response.status === 401 || response.status === 403) {
                            msg = 'Phiên đăng nhập của bạn đã hết hạn hoặc không hợp lệ. Vui lòng đăng nhập lại.';
                            localStorage.removeItem('jwtToken');
                            setTimeout(() => { window.location.href = 'http://127.0.0.1:5500/FE/index.html'; }, 2000);
                        }
                        errorMessage.textContent = msg;
                        errorMessage.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Lỗi fetch user profile:', error);
                    errorMessage.textContent = 'Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng.';
                    errorMessage.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    loadingIndicator.textContent = 'Đang tải thông tin tài khoản...';
                }
            }

            // Function to show display mode
            function showDisplayMode() {
                if (displayMode) displayMode.classList.remove('hidden');
                if (profileUpdateForm) profileUpdateForm.classList.add('hidden');
                if (changePasswordForm) changePasswordForm.classList.add('hidden');
            }

            // Function to show edit mode
            function showEditMode() {
                if (displayMode) displayMode.classList.add('hidden');
                if (profileUpdateForm) profileUpdateForm.classList.remove('hidden');
                if (changePasswordForm) changePasswordForm.classList.add('hidden');
                // Ensure form fields are populated with current data before editing
                if (nameInput) nameInput.value = currentProfileData.name || '';
                if (emailInput) emailInput.value = currentProfileData.email || '';
                if (bankNameInput) bankNameInput.value = currentProfileData.bankName || '';
                if (bankAddressInput) bankAddressInput.value = currentProfileData.bankAdress || ''; // Đã sửa lỗi chính tả
            }

            // Function to show change password mode
            function showChangePasswordMode() {
                if (displayMode) displayMode.classList.add('hidden');
                if (profileUpdateForm) profileUpdateForm.classList.add('hidden');
                if (changePasswordForm) changePasswordForm.classList.remove('hidden');
                // Clear password fields when opening the form
                if (currentPasswordInput) currentPasswordInput.value = '';
                if (newPasswordInput) newPasswordInput.value = '';
                if (confirmPasswordInput) confirmPasswordInput.value = '';
            }

            // Event listener for "Cập nhật" button
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', () => {
                    showEditMode();
                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                });
            }

            // Event listener for "Đổi mật khẩu" button
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', () => {
                    showChangePasswordMode();
                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                });
            }

            // Event listener for "Hủy" button on profile update form
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', () => {
                    showDisplayMode();
                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                });
            }

            // Event listener for "Hủy" button on change password form
            if (cancelChangePasswordBtn) {
                cancelChangePasswordBtn.addEventListener('click', () => {
                    showDisplayMode();
                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                });
            }

            // Function to handle profile update form submission
            if (profileUpdateForm) {
                profileUpdateForm.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                    if (loadingIndicator) {
                        loadingIndicator.textContent = 'Đang lưu thay đổi...';
                        loadingIndicator.classList.remove('hidden');
                    }

                    const updatePayload = {
                        name: nameInput.value,
                        email: emailInput.value,
                        bankName: bankNameInput.value,
                        bankAdress: bankAddressInput.value // Đã sửa lỗi chính tả: 'bankAdress'
                    };

                    try {
                        const apiUrl = BASE_SHORT_URL_DOMAIN + USER_API_V1_PATH + '/profile/update';
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify(updatePayload)
                        });

                        const data = await response.json();
                        console.log('Profile Update API Response:', data);

                        if (response.ok && data.message === WEB_CONSTANTS_BASE_SUCCESS) {
                            if (successMessage) {
                                successMessage.textContent = 'Cập nhật thông tin thành công!';
                                successMessage.classList.remove('hidden');
                            }
                            await fetchUserProfile(); // Tải lại thông tin người dùng sau khi cập nhật thành công
                        } else {
                            let msg = data.message || 'Không thể cập nhật thông tin. Vui lòng thử lại.';
                            if (errorMessage) {
                                errorMessage.textContent = msg;
                                errorMessage.classList.remove('hidden');
                            }
                        }
                    } catch (error) {
                        console.error('Lỗi update profile:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Không thể kết nối đến máy chủ để cập nhật. Vui lòng kiểm tra kết nối mạng.';
                            errorMessage.classList.remove('hidden');
                        }
                    } finally {
                        if (loadingIndicator) {
                            loadingIndicator.classList.add('hidden');
                            loadingIndicator.textContent = 'Đang tải thông tin tài khoản...';
                        }
                    }
                });
            }

            // Function to handle change password form submission
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    if (errorMessage) errorMessage.classList.add('hidden');
                    if (successMessage) successMessage.classList.add('hidden');
                    if (loadingIndicator) {
                        loadingIndicator.textContent = 'Đang đổi mật khẩu...';
                        loadingIndicator.classList.remove('hidden');
                    }

                    const currentPassword = currentPasswordInput.value;
                    const newPassword = newPasswordInput.value;
                    const confirmPassword = confirmPasswordInput.value;

                    if (newPassword !== confirmPassword) {
                        if (errorMessage) {
                            errorMessage.textContent = 'Mật khẩu mới và xác nhận mật khẩu không khớp.';
                            errorMessage.classList.remove('hidden');
                        }
                        if (loadingIndicator) loadingIndicator.classList.add('hidden');
                        return;
                    }

                    const changePasswordPayload = {
                        currentPassword: currentPassword,
                        newPassword: newPassword,
                        confirmPassword: confirmPassword
                    };

                    try {
                        const apiUrl = BASE_SHORT_URL_DOMAIN + USER_API_V1_PATH + '/account/changepass';
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify(changePasswordPayload)
                        });

                        const data = await response.json();
                        console.log('Change Password API Response:', data);

                        if (response.ok && data.message === WEB_CONSTANTS_BASE_SUCCESS) {
                            if (successMessage) {
                                successMessage.textContent = 'Đổi mật khẩu thành công!';
                                successMessage.classList.remove('hidden');
                            }
                            // Bạn có thể cân nhắc đăng xuất người dùng sau khi đổi mật khẩu để bảo mật hơn
                            // setTimeout(() => { localStorage.removeItem('jwtToken'); window.location.href = 'http://127.0.0.1:5500/FE/index.html'; }, 2000);
                            showDisplayMode(); // Quay lại chế độ hiển thị thông tin
                        } else {
                            let msg = data.message || 'Không thể đổi mật khẩu. Vui lòng thử lại.';
                            if (errorMessage) {
                                errorMessage.textContent = msg;
                                errorMessage.classList.remove('hidden');
                            }
                        }
                    } catch (error) {
                        console.error('Lỗi change password:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Không thể kết nối đến máy chủ để đổi mật khẩu. Vui lòng kiểm tra kết nối mạng.';
                            errorMessage.classList.remove('hidden');
                        }
                    } finally {
                        if (loadingIndicator) {
                            loadingIndicator.classList.add('hidden');
                            loadingIndicator.textContent = 'Đang tải thông tin tài khoản...';
                        }
                    }
                });
            }

            fetchUserProfile(); // Gọi hàm tải thông tin hồ sơ khi trang được tải
        });
    </script>
</body>

</html>